@model IEnumerable<EagleFlow.Models.Document>
@{
    ViewData["Title"] = "Admin Dashboard";
}

<h1 class="h3 mb-3">Admin - PDF Documents</h1>

@if (TempData["Success"] is string success)
{
    <div class="alert alert-success">@success</div>
}
@if (TempData["Error"] is string error)
{
    <div class="alert alert-danger">@error</div>
}

<div class="card shadow-sm mb-4">
    <div class="card-body">
        <h2 class="h5">Upload PDF</h2>
        <form asp-action="Upload" method="post" enctype="multipart/form-data">
            <div class="row g-2 align-items-center">
                <div class="col-md-8">
                    <input type="file" name="File" class="form-control" accept="application/pdf,.pdf" required />
                    <div class="form-text">PDF only. Max size 10 MB.</div>
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">Upload</button>
                </div>
            </div>
        </form>
    </div>
</div>

<form method="get" class="row g-2 mb-3">
    <div class="col-md-6">
        <input type="text" name="search" class="form-control" value="@ViewBag.Search" placeholder="Search by document number" />
    </div>
    <div class="col-md-2">
        <button type="submit" class="btn btn-outline-secondary w-100">Search</button>
    </div>
</form>

<table class="table table-striped table-bordered align-middle">
    <thead>
        <tr>
            <th>Document Number</th>
            <th>Original Name</th>
            <th>Upload Date (UTC)</th>
            <th>Size</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var doc in Model)
    {
        <tr>
            <td>@doc.DocumentNumber</td>
            <td>@doc.OriginalFileName</td>
            <td>@doc.UploadDate.ToString("yyyy-MM-dd HH:mm")</td>
            <td>@(doc.FileSize / 1024) KB</td>
            <td>@(doc.IsDeleted ? "Deleted" : "Active")</td>
            <td>
                @if (!doc.IsDeleted)
                {
                    <a class="btn btn-sm btn-outline-primary" asp-controller="Public" asp-action="ViewDocument" asp-route-documentNumber="@doc.DocumentNumber" target="_blank">View</a>
                    <a class="btn btn-sm btn-outline-success" asp-controller="Public" asp-action="Download" asp-route-documentNumber="@doc.DocumentNumber">Download</a>
                    <form asp-action="Delete" method="post" class="d-inline">
                        <input type="hidden" name="documentNumber" value="@doc.DocumentNumber" />
                        <button type="submit" class="btn btn-sm btn-outline-danger">Soft Delete</button>
                    </form>
                }
            </td>
        </tr>
    }
    </tbody>
</table>
